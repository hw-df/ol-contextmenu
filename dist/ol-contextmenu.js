/*!
  * ol-contextmenu - v4.1.2
  * https://github.com/jonataswalker/ol-contextmenu
  * Built: Fri Sep 16 2022 16:13:01 GMT+0200 (Central European Summer Time)
  */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("ol/control/Control")):"function"==typeof define&&define.amd?define(["ol/control/Control"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).ContextMenu=t(e.ol.control.Control)}(this,(function(e){"use strict";function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n=t(e);const s="ol-ctx-menu";var i={namespace:s,container:s+"-container",separator:s+"-separator",submenu:s+"-submenu",hidden:s+"-hidden",icon:s+"-icon",zoomIn:s+"-zoom-in",zoomOut:s+"-zoom-out",unselectable:"ol-unselectable"};const o=i,a="beforeopen",r="open",l="close",c="contextmenu",h={width:150,scrollAt:4,eventType:c,defaultItems:!0},d=[{text:"Zoom In",classname:`${i.zoomIn} ${i.icon}`,callback:(e,t)=>{const n=t.getView();n.animate({zoom:+n.getZoom()+1,duration:700,center:e.coordinate})}},{text:"Zoom Out",classname:`${i.zoomOut} ${i.icon}`,callback:(e,t)=>{const n=t.getView();n.animate({zoom:+n.getZoom()-1,duration:700,center:e.coordinate})}}];function u(e,t="Assertion failed"){if(!e){if("undefined"!=typeof Error)throw new Error(t);throw t}}function m(e){return/^\d+$/.test(e)}function p(e,t){return e.classList?e.classList.contains(t):b(t).test(e.className)}function f(e,t=window.document,n){let s=/\./g,i=Array.prototype.slice,o=[];if(/^(#?[\w-]+|\.[\w-.]+)$/.test(e))switch(e[0]){case"#":o=[g(e.substr(1))];break;case".":o=i.call(t.getElementsByClassName(e.substr(1).replace(s," ")));break;default:o=i.call(t.getElementsByTagName(e))}else o=i.call(t.querySelectorAll(e));return n?o:o[0]}function g(e){return e="#"===e[0]?e.substr(1,e.length):e,document.getElementById(e)}function y(e){let t=document.createDocumentFragment(),n=document.createElement("div");for(n.innerHTML=e;n.firstChild;)t.appendChild(n.firstChild);return t}function b(e){return new RegExp(`(^|\\s+) ${e} (\\s+|$)`)}function v(e,t,n){e.classList?e.classList.add(t):e.className=(e.className+" "+t).trim(),n&&m(n)&&window.setTimeout(()=>C(e,t),n)}function C(e,t,n){e.classList?e.classList.remove(t):e.className=e.className.replace(b(t)," ").trim(),n&&m(n)&&window.setTimeout(()=>v(e,t),n)}class E{constructor(e){return this.Base=e,this.map=void 0,this.viewport=void 0,this.coordinateClicked=void 0,this.pixelClicked=void 0,this.lineHeight=0,this.items={},this.opened=!1,this.submenu={left:e.options.width-15+"px",lastLeft:""},this.eventHandler=this.handleEvent.bind(this),this.eventMapMoveHandler=this.handleMapMoveEvent.bind(this),this}init(e){this.map=e,this.viewport=e.getViewport(),this.setListeners(),this.Base.Html.createMenu(),this.lineHeight=this.getItemsLength()>0?this.Base.container.offsetHeight/this.getItemsLength():this.Base.Html.cloneAndGetLineHeight()}getItemsLength(){let e=0;return Object.keys(this.items).forEach(t=>{this.items[t].submenu||this.items[t].separator||e++}),e}getPixelClicked(){return this.pixelClicked}getCoordinateClicked(){return this.coordinateClicked}positionContainer(e){const t=this.Base.container,n=this.map.getSize(),s=n[1]-e[1],i=n[0]-e[0],a=t.offsetWidth,r=Math.round(this.lineHeight*this.getItemsLength()),l=f(`li.${o.submenu}>div`,t,!0);i>=a?(t.style.right="auto",t.style.left=e[0]+5+"px"):(t.style.left="auto",t.style.right="15px"),s>=r?(t.style.bottom="auto",t.style.top=e[1]-10+"px"):(t.style.top="auto",t.style.bottom=0),function e(t,n,s){if(Array.isArray(t))return void t.forEach(t=>e(t,n,s));const i=Array.isArray(n)?n:n.split(/\s+/);let o=i.length;for(;o--;)p(t,i[o])&&C(t,i[o],s)}(t,o.hidden),l.length&&(this.submenu.lastLeft=i<2*a?`-${a}px`:this.submenu.left,l.forEach(e=>{const t={w:window.innerWidth||document.documentElement.clientWidth,h:window.innerHeight||document.documentElement.clientHeight},n=function(e){const t=e.getBoundingClientRect(),n=document.documentElement;return{left:t.left+window.pageXOffset-n.clientLeft,top:t.top+window.pageYOffset-n.clientTop,width:e.offsetWidth,height:e.offsetHeight}}(e),i=n.height;let o=s-i;o<0&&(o=i-(t.h-n.top),e.style.top=`-${o}px`),e.style.left=this.submenu.lastLeft}))}openMenu(e,t){this.Base.dispatchEvent({type:r,pixel:e,coordinate:t}),this.opened=!0,this.positionContainer(e)}closeMenu(){this.opened=!1,function e(t,n,s){if(Array.isArray(t))return void t.forEach(t=>e(t,n));const i=Array.isArray(n)?n:n.split(/\s+/);let o=i.length;for(;o--;)p(t,i[o])||v(t,i[o],s)}(this.Base.container,o.hidden),this.Base.dispatchEvent({type:l})}setListeners(){this.viewport.addEventListener(this.Base.options.eventType,this.eventHandler,!1),this.map.on("movestart",this.eventMapMoveHandler)}removeListeners(){this.viewport.removeEventListener(this.Base.options.eventType,this.eventHandler,!1),this.map.un("movestart",this.eventMapMoveHandler)}handleEvent(e){const t=this;this.coordinateClicked=this.map.getEventCoordinate(e),this.pixelClicked=this.map.getEventPixel(e),this.Base.dispatchEvent({type:a,pixel:this.pixelClicked,coordinate:this.coordinateClicked}),this.Base.disabled||(this.Base.options.eventType===c&&(e.stopPropagation(),e.preventDefault()),this.openMenu(this.pixelClicked,this.coordinateClicked),e.target.addEventListener("pointerdown",{handleEvent:function(n){const s=n.target.parentNode.classList.contains("ol-ctx-menu-submenu");t.opened&&!s&&(t.closeMenu(),n.stopPropagation(),e.target.removeEventListener(n.type,this,!1))}},!1))}handleMapMoveEvent(e){this.closeMenu()}setItemListener(e,t){const n=this;var s;e&&"function"==typeof this.items[t].callback&&(s=this.items[t].callback,e.addEventListener("click",(function(e){e.preventDefault();const i={coordinate:n.getCoordinateClicked(),data:n.items[t].data||null};n.closeMenu(),s(i,n.map)}),!1))}}class w{constructor(e){return this.Base=e,this.container=this.Base.container,this}static createContainer(e,t){const n=document.createElement("div"),s=document.createElement("ul"),i=[o.container,o.unselectable];return e&&i.push(o.hidden),n.className=i.join(" "),n.style.width=parseInt(t,10)+"px",n.appendChild(s),n}createMenu(){let e=[];if("items"in this.Base.options?e=this.Base.options.defaultItems?this.Base.options.items.concat(d):this.Base.options.items:this.Base.options.defaultItems&&(e=d),0===e.length)return!1;e.forEach(this.addMenuEntry,this)}addMenuEntry(e){if(e.items&&Array.isArray(e.items)){e.classname=e.classname||"",t=o.submenu,~e.classname.indexOf(t)||(e.classname=e.classname.length?" "+o.submenu:o.submenu);let n=this.generateHtmlAndPublish(this.container,e),s=this.constructor.createContainer(!1,this.Base.options.width);s.style.left=this.Base.Internal.submenu.lastLeft||this.Base.Internal.submenu.left,n.appendChild(s),e.items.forEach(e=>{this.generateHtmlAndPublish(s,e,!0)})}else this.generateHtmlAndPublish(this.container,e);var t}generateHtmlAndPublish(e,t,n){const s="_"+Math.random().toString(36).substr(2,9);let i,a,r,l=!1;return"string"==typeof t&&"-"===t.trim()?(i=`<li id="${s}" class="${o.separator}"><hr></li>`,a=y(i),r=[].slice.call(a.childNodes,0)[0],e.firstChild.appendChild(a),l=!0):(t.classname=t.classname||"",i=`<span>${t.text}</span>`,a=y(i),r=document.createElement("li"),t.icon&&(""===t.classname?t.classname=o.icon:-1===t.classname.indexOf(o.icon)&&(t.classname+=" "+o.icon),r.setAttribute("style",`background-image:url(${t.icon})`)),r.id=s,r.className=t.classname,r.appendChild(a),e.firstChild.appendChild(r)),this.Base.Internal.items[s]={id:s,submenu:n||0,separator:l,callback:t.callback,data:t.data||null},this.Base.Internal.setItemListener(r,s),r}removeMenuEntry(e){const t=f("#"+e,this.container.firstChild);t&&this.container.firstChild.removeChild(t),delete this.Base.Internal.items[e]}cloneAndGetLineHeight(){const e=this.container.cloneNode(),t=y("<span>Foo</span>"),n=y("<span>Foo</span>"),s=document.createElement("li"),i=document.createElement("li");s.appendChild(t),i.appendChild(n),e.appendChild(s),e.appendChild(i),this.container.parentNode.appendChild(e);const o=e.offsetHeight/2;return this.container.parentNode.removeChild(e),o}}class M extends n.default{constructor(e={}){u("object"==typeof e,"@param `opt_options` should be object type!");let t=function(e,t){let n={};for(let t in e)n[t]=e[t];for(let e in t)n[e]=t[e];return n}(h,e);const n=w.createContainer(!0,t.width);super({element:n}),this.container=this.element=n,this.options=t,this.disabled=!1,this.Internal=new E(this),this.Html=new w(this)}clear(){Object.keys(this.Internal.items).forEach(this.Html.removeMenuEntry,this.Html)}close(){this.Internal.closeMenu()}enable(){this.disabled=!1}disable(){this.disabled=!0}getDefaultItems(){return d}countItems(){return Object.keys(this.Internal.items).length}extend(e){u(Array.isArray(e),"@param `arr` should be an Array."),e.forEach(this.push,this)}isOpen(){return this.Internal.opened}updatePosition(e){u(Array.isArray(e),"@param `pixel` should be an Array."),this.isOpen()&&this.Internal.positionContainer(e)}pop(){const e=Object.keys(this.Internal.items);this.Html.removeMenuEntry(e[e.length-1])}push(e){u(null!=e,"@param `item` must be informed."),this.Html.addMenuEntry(e)}shift(){this.Html.removeMenuEntry(Object.keys(this.Internal.items)[0])}setMap(e){n.default.prototype.setMap.call(this,e),e?this.Internal.init(e,this):this.Internal.removeListeners()}}return M}));
